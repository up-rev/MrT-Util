<!DOCTYPE html>
<html>
<head>
  <title>${obj.name.upper()} Device</title>
</head>
<body>
<div class="content">
<h1>${obj.name.upper()} Device</h1>
<ul>
  <li> Generated with <a href="https://github.com/uprev-mrt/mrtutils/wiki/mrt-device">MrT Device Utility</a> </li>
  <li> Bus:  ${obj.bus}</li>
  %if not obj.datasheet == '':
  <li>Datasheet: <a href="${obj.datasheet}">${obj.datasheet[:24] + (obj.datasheet[24:] and '...')}</a> </li>
  %endif
  %if not obj.digikey_pn == '':
  <li> DigiKey: <a href="https://www.digikey.com/products/en?KeyWords=${obj.digikey_pn}">${obj.digikey_pn}</a></li>
  %endif
  %if "I2C" in obj.bus.upper():
  <li> I2C Address: ${ obj.formatHex(obj.i2c_addr, 1)}</li>
  %endif
</ul>
<hr/>
<h2>Description: </h2>
<p>${obj.desc}</p>

<br/>

<div class="regmap" align="center">
<hr class="section">
<h2 class="right"> Register Map</h2>
<div align="right" width="100%">
  Configuration:
  <select id="cfgSelect" onchange="setConfig(this)"> 
    <option value="none">None</option>
  </select>
</div>
<hr class="thick">

<table class="fields" width="95%">
    <tr>
      <th width="14%">Register</th>
      <th width="1%">RW</th>
      %for i in range(obj.smallestReg * 8):
      <th width="${85/ (obj.smallestReg * 8)}%"> ${(obj.smallestReg *8) -(i+1)}</th>
      %endfor
    </tr>
    %for key, reg in obj.regs.items():
     ${reg.printRegMap(obj.smallestReg *8)}
     %endfor
  </table>
</div>


</div>
<script>
  
  var device = {
    regSize : 32,
    currentVals : {},
    configs :{}
  };

var cfgDefault_vals = [];
% for key,reg in obj.regs.items():
% if reg.hasDefault:
    cfgDefault_vals.push({ name: "${reg.name}", val : ${reg.default} });
% endif
% endfor
device.configs['Default'] = cfgDefault_vals;


%for key,config in obj.configs.items():
var cfg${config.name}_vals = [];
%for regVal in config.regVals:
<% name , val = obj.getConfigRegVal(regVal) %> \
    cfg${config.name}_vals.push({ name: "${name}", val : ${val} });
%endfor
device.configs['${config.name}'] = cfg${config.name}_vals;
%endfor

  
function showSettings(){
    for(var k in device.currentVals){
      var v = device.currentVals[k];
      var bit = device.regSize - 1; //0 based
      var mask =0;
      while(bit >= 0)
      {
        mask = (v >> bit) & 1;
        var element = document.getElementById(k + "_bit_" + bit);
        
        if(element)
        {
          if(mask)
          {
            element.classList.add("one");
            element.classList.remove("zero");
          }
          else
          {
            element.classList.remove("one");
            element.classList.add("zero");
          }

        }

        bit--;
      }

    }
  }


  function loadConfig(config)
  {
    if(config == 'none')
    {
      var bits = document.getElementsByClassName("bit");
      for(var i = 0; i < bits.length; i++)
      {
        bits[i].classList.remove("one");
        bits[i].classList.remove("zero");
      }

    }
    else
    {
      //first load defaults 
      device.configs['Default'].forEach(val => {
        device.currentVals[val.name] = val.val;
      });
  
      device.configs[config].forEach(val => {
        device.currentVals[val.name] = val.val;
      });
      showSettings();
    }

  }


  function setConfig(selectObj)
  {
    var value = selectObj.value;
    loadConfig(value);
  }

  var sel =  document.getElementById("cfgSelect");

  for(var k in device.configs){
    var option = document.createElement("option");
    option.text = k;
    option.Value = k;
    sel.add(option);
  }


</script>
</body>
<style>
table.fixed { table-layout:auto; }
table.fixed td { overflow:visible; }

table.fields{
  table-layout:auto;
}

body {
  padding:0;
}

.content{
  padding-top: 0;
  padding-left: 1%;
  padding-right: 1%;
  background-color: #fff;
}

@media print {
  .regmap {
    page-break-inside: avoid;
  }
  .content{
    width: 100%;
  }
  body{
    background-color: #fff;
  }
}

@media screen {
  .content{
    width: 50%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    padding-top: 4px;
    box-shadow: 5px 10px #AAA;
    padding-bottom: 50px;
  }

  body{
    background-color: #ccc;
    padding: 0;
  }
}

html *{
  font-size: 1em ;
   color: #000 ;
  font-family: Arial ;
}

hr.section {
  border-style: solid;
  border-width: 2px;
  opacity: 1;
}


hr.thick {
  border-style: solid;
  border-width: 1px;
  border-color: #94b2d3;
  opacity: 1;
}

hr {
  opacity: 0.5;
}

table {
  border-collapse: collapse;
}

td {
  border: 1px solid #000000;
  text-align: left;
  padding-top: 6px;
  vertical-align: top;
  font-size: 9pt;
  width: 1px;
  white-space: nowrap;
}

.field{
  text-align: center;
  padding: 0px;
}


.bit{
  border-right: 1px dotted #999;
  border-left: 1px dotted #999;
}

.bit.first{
  border-left: 1px solid black;
}

td:last-child{
  border-right: 1px solid black;
}
td:first-child{
  border-left: 1px solid black;
}


td.one{
  background-color: #acdbac;
}

td.zero{
  background-color: #e2af9e;
}

.first{
  border-lef
}

td.empty{
  background-color: #cccccc;
  color: #cccccc;
}

td.field{
  width: 1px;
  white-space: nowrap;
  text-align: center;
}

.desc{
  font-size: 1.2em;
}

th {
  border: 1px solid #000000;
  text-align: left;
  padding: 5px;
  background-color: #94b2d3;
  font-size: 9pt;
}

li.val{
  opacity: 0.6;
}

h1{
  font-size: 2.0em;
}

h2 
{
  font-size: 1.3em;
}

h2.right{
  text-align: center;
  font-size: 1.3em;
}

h3
{
  font-size: 1.8em;
  color: #003366;
}

h4 
{
  font-size: 1.1em;
  color: #003366;
}


.note{
  font-style: italic;
  opacity: 0.6;
}

a{
  text-decoration:none;
}

a:link {
  color: blue;
}

/* visited link */
a:visited {
  color: blue;
}

table.fixed tr td:last-child{
    width:1%;
    white-space:nowrap;
}

[data-tt] {
  position: relative;
  cursor: help;
}

[data-tt]:before,
[data-tt]:after {
  display: none;
  position: absolute;
  top: 0;
}

[data-tt]:before {
  border-bottom: .6em solid #09f;
  border-bottom: .6em solid rgba(0,153,255,0.8);
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  content: "";
  left: 20px;
  margin-top: 1em;
}

[data-tt]:after {
  background-color: #387aa7;
  background-color: rgb(162, 197, 221);
  border: 2px solid #000000;
  border: 2px solid rgba(0, 0, 0, 1);
  border-radius: 2px;
  color: #000000;
  content: attr(data-tt-lbl) ":\A" attr(data-tt-msg);
  left: 0;
  width: 300px;
  overflow: auto;
  text-align: left;
  margin-top: 1.5em;
  padding: 5px 15px;
  white-space: pre-wrap;
  z-index: 100;
}

[data-tt]:hover:after,
[data-tt]:hover:before {
  display: block;
  overflow: auto;
}

</style>
</html>
